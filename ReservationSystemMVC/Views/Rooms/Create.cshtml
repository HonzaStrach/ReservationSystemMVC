@model Room

@{
    ViewData["Title"] = "Vytvoření nového pokoje";
}

<div class="w3-container">
    <div class="w3-container w3-indigo">
        <h2>Vytvoření nového pokoje</h2>
    </div>

    @using (Html.BeginForm("Create", "Rooms", FormMethod.Post, new { @class = "w3-container" }))
    {
        @Html.AntiForgeryToken()

        <p>
            @Html.EditorFor(model => model.RoomNumber, new { htmlAttributes = new { @class = "w3-input" } })
            @Html.LabelFor(model => model.RoomNumber, new { @class = "w3-text-blue" })
            @Html.ValidationMessageFor(model => model.RoomNumber, "", new { @class = "w3-text-red" })
        </p>

        <p>
            @Html.LabelFor(model => model.RoomTypeId, new { @class = "w3-text-blue" })
            <a href="#" id="AddNewRoomType" class="w3-text-blue w3-right" style="text-decoration:none">Vytvořit nový typ pokoje</a>
            @Html.DropDownListFor(model => model.RoomTypeId, (SelectList)ViewData["RoomTypeId"], "Vyberte typ pokoje", new { @id = "RoomTypeId", @class = "w3-select w3-border" })
            @Html.ValidationMessageFor(model => model.RoomTypeId, "", new { @class = "w3-text-red" })
        </p>

        <p>
            @Html.EditorFor(model => model.MaxOccupancy, new { htmlAttributes = new { @class = "w3-input" } })
            @Html.LabelFor(model => model.MaxOccupancy, new { @class = "w3-text-blue" })
            @Html.ValidationMessageFor(model => model.MaxOccupancy, "", new { @class = "w3-text-red" })
        </p>

        <p>
            @Html.CheckBoxFor(model => model.ExtraBedAvailable, new { @class = "w3-check", @title = "Zvýší počet lůžek o 1" })
            @Html.LabelFor(model => model.ExtraBedAvailable, new { @class = "w3-text-blue" })
            @Html.ValidationMessageFor(model => model.ExtraBedAvailable, "", new { @class = "w3-text-red" })
        </p>

        <p>
            <button id="EquipmentButton" class="w3-button w3-block w3-light-blue w3-left-align w3-hover-light-blue w3-text-white w3-hover-text-white">
                Vybavení pokoje <i id="EquipmentArrow" class="fa-solid fa-angles-down"></i>
                <a href="#" id="AddNewRoomEquipment" class="w3-text-blue w3-right" style="text-decoration:none">Vytvořit nové vybavení pokoje</a>
            </button>

            <div id="EquipmentSelector" class="w3-container w3-hide">
                <div class="w3-row" id="myGrid" style="margin-bottom:128px">
                    @for (int i = 0; i < 3; i++)
                    {
                        <div class="w3-third">
                            @foreach (var equipment in (ViewData["RoomEquipmentColumns"] as Array))
                            {
                                @equipment
                            }
                        </div>
                    }
                </div>
            </div>
        </p>

        <button type="submit" class="w3-button w3-indigo w3-hover-blue w3-right">Vytvořit nový pokoj</button>
    }

    <div>
        <a asp-action="Index">Zpět na seznam pokojů</a>
    </div>

</div>

@await Html.PartialAsync("_AddRoomTypePartial", new RoomType())

@await Html.PartialAsync("_AddRoomEquipmentPartial", new RoomEquipment())

@section Head {
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/3aeded1a52.js" crossorigin="anonymous"></script>
    <style>
        select#RoomEquipmentIcon {
            font-family: 'FontAwesome';
            font-size: 1.5em;
        }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            $("#AddNewRoomType").click(function (e) {
                e.preventDefault();
                $("#NewRoomTypeSection").toggle();
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            // Handler for adding a new RoomType
            $("#addRoomTypeForm").submit(function (e) {
                e.preventDefault();
                $.ajax({
                    url: $(this).attr("action"),
                    type: "POST",
                    data: $(this).serialize(),
                    success: function (data) {
                        if (data.success) {
                            // Close the form
                            $("#NewRoomTypeSection").toggle();
                            // Add the new RoomType to the RoomTypeId dropdown
                            $("#RoomTypeId").append(new Option(data.roomType, data.roomTypeId, false, true));
                        } else {
                            alert(data.message)
                        }
                    }
                });
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $("#EquipmentButton").click(function (e) {
                e.preventDefault();
                $("#EquipmentSelector").toggleClass("w3-hide w3-show");
                $("#EquipmentArrow").toggleClass("fa-angles-down fa-angles-up");
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $("#AddNewRoomEquipment").click(function (e) {
                e.preventDefault();
                $("#NewRoomEquipmentSection").toggle();
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            // Handler for adding a new RoomType
            $("#addRoomEquipmentForm").submit(function (e) {
                e.preventDefault();
                $.ajax({
                    url: $(this).attr("action"),
                    type: "POST",
                    data: $(this).serialize(),
                    success: function (data) {
                        if (data.success) {
                            // Close the form
                            $("#NewRoomEquipmentSection").toggle();
                            // Ask GPT to make the code for adding it to the list of equpiments
                            
                        } else {
                            alert(data.message)
                        }
                    }
                });
            });
        });
    </script>
}